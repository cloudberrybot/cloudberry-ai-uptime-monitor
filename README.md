# cloudberry-uptime-monitor

<a alt="Nx logo" href="https://nx.dev" target="_blank" rel="noreferrer"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-logo.png" width="45"></a>

✨ **This workspace has been generated by [Nx, a Smart, fast and extensible build system.](https://nx.dev)** ✨

## Understand this workspace

There are two projects inside the NX workspace packages folder:

`uptime-monitor-engine`: engine that runs the uptime and content requirements checks.
`uptime-monitor-service`: microservice that stores the data generated by the `uptime-monitor-engine`

Run `nx graph` to see a diagram of the dependencies of the projects.

## Tooling

Nodejs LTS
Docker
Playwright
Nx

## Architecture

`uptime-monitor-service`: micro service responsible of sending the uptime events to the database
`uptime-monitor-engine`: Node.js app that run the uptime events periodically. The config file path is `config/uptime-monitor.config.js`

### Improvements

The architecture would benefit of using a queue system to ensure the uptime events are registered in case of any microservice failure.

Add database sharding to set up a distributed system and availability of data accross different locations.

Use GRPC and use protobuf instead of RESTFul API for better communication and security of data being sent to the API. 

## Environment variables

### Database

Create a .env file inside /database and set a value for `DB_PASSWORD`. We recommend not to update the DB_NAME value, if you do make sure to update the docker-compose.yml file and the Prisma .env file.

```shell
DB_USER=admin
DB_PASSWORD=
DB_PORT=5432
DB_NAME=uptime
```

### ORM (Prisma)

Prisma is the ORM used to communicate with the database.

Create a .env file inside /prisma and set a DATABASE_URL value. Replace <DB_PASSWORD> with the password you set on the previous step.

```shell
DATABASE_URL=postgresql://admin:<DB_PASSWORD>@localhost:5432/uptime?schema=monitor
```

## Run the solution

Following steps should run in different terminal windows.

### Database

`uptime-monitor-service` logs the check events in the `uptime` mongo db collection.

Open a new terminal or console and run the following comands to spin up the database. 

```terminal
cd database
docker compose up
```

### Run the microservice

```shell
npx nx server uptime-monitor-service
```

### Run the engine

```shell
npx nx server uptime-monitor-engine

```

## Remote caching

Run `npx nx connect-to-nx-cloud` to enable [remote caching](https://nx.app) and make CI faster.

## Further help

Visit the [Nx Documentation](https://nx.dev) to learn more.

